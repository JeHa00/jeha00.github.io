<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>스프링 컨테이너, 스프링 빈, 싱글톤 레지스트리란? | Jeha DevLog</title><meta name=keywords content="Spring"><meta name=description content="스프링 컨테이너와 스프링 빈이 무엇인지 / 빈 생성 및 등록 과정 / 스프링 컨테이너의 인터페이스의 코드 구조 / BeanDefinition / 싱글톤 설계 시 유의사항 / 스프링이 싱글톤 레지스트리가 가능한 이유 에 대해 알아본다."><meta name=author content="Me"><link rel=canonical href=http://jeha00.github.io/post/spring/study_1/><meta name=google-site-verification content="XYZabc"><meta name=yandex-verification content="XYZabc"><meta name=msvalidate.01 content="XYZabc"><link crossorigin=anonymous href=/assets/css/stylesheet.min.8330bf30523628d00ababead16d63a7b5cd7570bd4901cb3c11ec258628d7a67.css integrity="sha256-gzC/MFI2KNAKur6tFtY6e1zXVwvUkByzwR7CWGKNemc=" rel="preload stylesheet" as=style><link rel=icon href=http://jeha00.github.io/favicon.ico><link rel=icon type=image/png sizes=16x16 href=http://jeha00.github.io/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=http://jeha00.github.io/favicon-32x32.png><link rel=apple-touch-icon href=http://jeha00.github.io/apple-touch-icon.png><link rel=mask-icon href=http://jeha00.github.io/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><meta name=generator content="Hugo 0.101.0"><noscript><style>#theme-toggle,.top-link{display:none}</style></noscript><script type=application/javascript>var doNotTrack=!1;doNotTrack||(function(e,t,n,s,o,i,a){e.GoogleAnalyticsObject=o,e[o]=e[o]||function(){(e[o].q=e[o].q||[]).push(arguments)},e[o].l=1*new Date,i=t.createElement(n),a=t.getElementsByTagName(n)[0],i.async=1,i.src=s,a.parentNode.insertBefore(i,a)}(window,document,"script","https://www.google-analytics.com/analytics.js","ga"),ga("create","UA-123-45","auto"),ga("send","pageview"))</script><meta property="og:title" content="스프링 컨테이너, 스프링 빈, 싱글톤 레지스트리란?"><meta property="og:description" content="스프링 컨테이너와 스프링 빈이 무엇인지 / 빈 생성 및 등록 과정 / 스프링 컨테이너의 인터페이스의 코드 구조 / BeanDefinition / 싱글톤 설계 시 유의사항 / 스프링이 싱글톤 레지스트리가 가능한 이유 에 대해 알아본다."><meta property="og:type" content="article"><meta property="og:url" content="http://jeha00.github.io/post/spring/study_1/"><meta property="og:image" content="http://jeha00.github.io/47"><meta property="article:section" content="post"><meta property="article:published_time" content="2024-12-15T04:28:22+09:00"><meta property="article:modified_time" content="2024-12-15T04:28:22+09:00"><meta property="og:site_name" content="JeHa00 DevLog"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="http://jeha00.github.io/47"><meta name=twitter:title content="스프링 컨테이너, 스프링 빈, 싱글톤 레지스트리란?"><meta name=twitter:description content="스프링 컨테이너와 스프링 빈이 무엇인지 / 빈 생성 및 등록 과정 / 스프링 컨테이너의 인터페이스의 코드 구조 / BeanDefinition / 싱글톤 설계 시 유의사항 / 스프링이 싱글톤 레지스트리가 가능한 이유 에 대해 알아본다."><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"http://jeha00.github.io/post/"},{"@type":"ListItem","position":2,"name":"스프링 컨테이너, 스프링 빈, 싱글톤 레지스트리란?","item":"http://jeha00.github.io/post/spring/study_1/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"스프링 컨테이너, 스프링 빈, 싱글톤 레지스트리란?","name":"스프링 컨테이너, 스프링 빈, 싱글톤 레지스트리란?","description":"스프링 컨테이너와 스프링 빈이 무엇인지 / 빈 생성 및 등록 과정 / 스프링 컨테이너의 인터페이스의 코드 구조 / BeanDefinition / 싱글톤 설계 시 유의사항 / 스프링이 싱글톤 레지스트리가 가능한 이유 에 대해 알아본다.","keywords":["Spring"],"articleBody":"1. 스프링 컨테이너와 스프링 빈 1.1 스프링 컨테이너와 스프링 빈이란? 스프링 컨테이너(Spring Container)란 IoC(제어의 역전, Inversion Of Control)와 DI (의존관계 주입, Dependency Injection)를 구현하기 위해 설계된 역할로, 개발자 대신 스프링 프레임워크가(IoC) 의존 관계 객체를 스프링 빈(Spring Bean) 객체로 생성하고 주입(DI)하고, 관리까지 전체적으로 담당해 객체 지향 프로그래밍을 위해 만들어진 도구다. 개발자가 직접하면 생성과 실행이 합쳐서 OCP, SRP가 깨지기 때문이다.\n위 개념에서 언급한 스프링 빈(Spring Bean)은 스프링 컨테이너에 저장된 객체를 의미한다. 스프링이 판단해서 스프링 빈으로 적절한 의존 관계가 주입된다.\n이 스프링 컨테이너 역할은 코드 상으로 BeanFactory 인터페이스를 통해 구현한다. 하지만 보통 BeanFactory 인터페이스를 상속받는 ApplicationContext 객체를 스프링 컨테이너라 부른다.\n스프링 빈(Spring Bean)은 @Configuration 애노케이션이 붙은 객체의 메서드 중 @Bean 애노테이션이 붙은 메서드의 호출 결과로 생성된 객체를 의미한다.\nApplicationContext (스프링 컨테이너) @Configuration @Bean 필요한 객체가 있으면 스프링 컨테이너가 스프링 빈으로 등록된 객체들에서 찾아 의존성 주입을 한다.\n1.2 스프링 빈 생성 및 등록 과정 스프링 컨테이너가 빈을 생성 및 등록하는 과정은 다음과 같다.\n첫 번째, 스프링 컨테이너 인터페이스에 @Configuration 애노케이션이 붙은 객체의 Class 정보를 전달해, 해당 구성 정보를 가지고 있는 스프링 컨테이너를 생성한다.\n스프링 컨테이너에는 Map 타입으로 ‘빈 이름’과 ‘빈 객체’를 사상하여 저장한다. 설정 정보 객체 1 2 3 4 @Configuration public class AppConfig { ... } 스프링 컨테이너 생성 1 ApplicationContext applicationContext = new AnnotationConfigApplicationContext(AppConfig.class); 두 번째, 이 설정 정보 객체(ex: AppConfig)에 @Bean 데코레이션이 존재하는 메서드를 실행해 메서드의 이름을 ‘Bean 이름’으로 하고, 메서드의 반환값으로 생신 객체를 ‘Bean’으로 저장한다. 이 때 빈 이름은 중복되면 안된다.\n세 번째, 그후, 설정 정보를 참고해 의존관계를 주입(DI)한다.\n1.3 스프링 컨테이너의 코드 구조 코드에서 ApplicationContext 타입을 클릭해서 들어가면 다음 내용을 확인할 수 있다.\n스프링 컨테이너라 불리는 두 객체(BeanFactory와 ApplicationContext)는 인터페이스(interface)이고, ApplicationContext는 BeanFactory를 상속받는다. 그래서 BeanFactory는 스프링 컨테이너의 최상위 인터페이스다.\nBeanFactory는 Bean을 조회할 때 사용하는 getBean() 메서드를 제공하는 역할을 수행한다. ApplicationContext는 이 BeanFactory를 상속받기 때문에 이 메서드를 사용할 수 있으면서 다양한 인터페이스를 상속받는다.\nApplicationContext의 소스 코드를 보면 BeanFactory 인터페이스를 바로 찾을 수 없다.\nBeanFactory 인터페이스는 이 인터페이스를 상속받는 다른 인터페이스를 통해 제공된다. 바로 ListableBeanFactory, HierarchicalBeanFactory 이 두 인터페이스다.\nListableBeanFactory는 빈을 조회하는데 사용되는 다양한 메서드를 제공한다. HierarchicalBeanFactory는 특정 빈이 존재하는지 확인하는데 사용된다. 그 밖에 다양한 인터페이스를 상속받는다.\nMessageSource: 국제화 기능(한국에서는 한국어로, 영어권에서는 영어로) EnvironmentCapable: 로컬, 개발, 운영 등 구분 ApplicationEventPublisher: 이벤트 발행 및 구독 ResourceLoader: 외부 리소스 조회 그리고 스프링의 설정 정보는 java외에도 Xml 형식으로도 가능하고, 그 외 다양한 형식으로 전달할 수 있다. @Configuration 처럼 어노테이션 방식으로 전달할 때는 AnnotationConfigApplicationContext를 통해서 전달받는다. 그러면 AnnotatedBeanDefinitionReader에 의해 설정 정보를 읽고, 빈의 메타 정보인 BeanDefinition을 생성한다.\nAnnotationConfigApplicationContext 객체의 소스 코드다.\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 // 소스 코드 public class AnnotationConfigApplicationContext extends GenericApplicationContext implements AnnotationConfigRegistry { private final AnnotatedBeanDefinitionReader reader; private final ClassPathBeanDefinitionScanner scanner; ... public AnnotationConfigApplicationContext(Class\u003c?\u003e... componentClasses) { this(); this.register(componentClasses); this.refresh(); } public void register(Class\u003c?\u003e... componentClasses) { ... this.reader.register(componentClasses); } } 밑에는 AnnotatedBeanDefinitionReader의 소스 코드다.\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 // 소스 코드 public class AnnotatedBeanDefinitionReader { private final BeanDefinitionRegistry registry; // Bean 메타 정보 저장소 ... public void register(Class\u003c?\u003e... componentClasses) { Class[] var2 = componentClasses; int var3 = componentClasses.length; for(int var4 = 0; var4 \u003c var3; ++var4) { Class\u003c?\u003e componentClass = var2[var4]; this.registerBean(componentClass); } } public void registerBean(Class\u003c?\u003e beanClass) { this.doRegisterBean(beanClass, ...) } } 1.4 BeanDefinition 스프링 컨테이너의 설정 정보는 자바 클래스 외에 xml을 사용해서도 생성할 수 있다. 다양한 방법으로 설정 정보를 가질 수 있는 이유는 여기서도 객체 지향의 원리는 역할과 구현을 구분했기 때문이다.\n스프링 컨테이너에 스프링 빈 같은 설정 정보는 BeanDefinition이라는 인터페이스에 의존한다.\n빈 설정에 대한 메타 정보이다. 경로는 package org.springframework.beans.factory.config에 존재한다. @Bean마다 메타 정보가 하나씩 생성된다. 이 정보를 기반으로 스프링 컨테이너에 스프링 빈이 생성 및 등록된다. AnnotationConfigApplicationContext 는 AnnotatedBeanDefinitionReader 를 사용해서 AppConfig.class 를 읽고 BeanDefinition 을 생성한다.\nBeanDefinition에 대해서는 너무 깊이있게 이해하기 보다는, 스프링이 다양한 형태의 설정 정보를 BeanDefinition으로 추상화해서 사용하는 것 정도만 이해하면 된다.\n1.5 스프링 빈 조회하기 등록된 빈도 조회할 수 있다.\ncase 1: Bean 객체로 조회할 수 있다. (getBean(빈 객체 클래스 정보)) getBean(MemberService.class) case 2: 만약 해당 Bean 객체로 된 것이 두 개 이상이면 Bean 객체와 Bean 이름을 함께 사용해 Bean을 조회하면 된다. (getBean(빈 이름, 빈 객체 클래스 정보)) case 3: 조회하는 빈 객체에 여러 자식들이 존재하면 자식들까지 가져온다.(getBeansOfType(특정 타입의 빈 클래스 정보)) case 4: 만약 특정 자식을 조회하고 싶으면 빈 이름을 사용하면 된다. (case2) 2. 싱글톤 레지스트리 2.1 싱글톤 패턴이란? 해당 객체를 서버에서 1개만 생성해 공유해서 사용하도록 설계하는 패턴\n스프링 컨테이너는 싱글톤 방식을 사용한다. 그러면 왜 싱글톤 방식을 사용하는지 이해하기 위해, 이 방식을 사용하지 않을 경우 발생되는 문제점에 대해 알아보자.\n만약 스프링 빈을 사용하는 것 없이 AppConfig의 설정 객체를 가져오려면 AppConfig의 인스턴스를 통해서 메서드를 실행하면 된다.\n1 2 3 4 5 6 7 8 9 10 11 12 13 void pureContainer() { AppConfig appConfig = new AppConfig(); //1. 조회: 호출할 때 마다 객체를 생성 MemberService memberService1 = appConfig.memberService(); //2. 조회: 호출할 때 마다 객체를 생성 MemberService memberService2 = appConfig.memberService(); //참조값이 다른 것을 확인 System.out.println(\"memberService1 = \" + memberService1); System.out.println(\"memberService2 = \" + memberService2); //memberService1 != memberService2 assertThat(memberService1).isNotSameAs(memberService2); } 각 메서드의 실행 결과 다음 객체를 새로 생성해서 반환한다.\nMemberService OrderService MemberRepository DiscountPolicy 만약 웹 애플리케이션이라면 request 요청이 들어올 때마다 이 서비스 객체를 호출한다면 매번 새로운 객체가 생성된다. 그러면 한 번 사용하고 사용되지 않으면 해당 서비스 객체는 GC에 의해 반복적으로 삭제된다. 이 방식은 ‘메모리 낭비가 심하다’는 단점이 존재한다.\n그래서 이에 대한 해결책이 해당 객체를 서버에서 1개만 생성해 공유해서 사용하도록 설계한다. 이러한 패턴을 ‘싱글톤(singleton) 패턴’이라 한다. 이러한 싱글톤 패턴의 특징 때문에 객체 인스턴스를 2개 이상 생성하지 못하도록 막아야 하므로 생성자의 접근 제어자를 반드시 private로 지정해야 한다.\n만약 싱글톤으로 사용되어야 하는 객체가 있다면 다음과 같이 코드를 구성하면 된다.\n클래스 변수로 단 하나의 인스턴스만 사용되고, 외부에서 접근하지 못하도록 private static final을 지정한다. 해당 객체를 사용하고 싶으면 특정 메서드를 통해서만 접근하도록 한다. 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 public class SingletonService { //1. static 영역에 객체를 딱 1개만 생성해둔다. private static final SingletonService instance = new SingletonService(); //2. public으로 열어서 객체 인스턴스가 필요하면 이 static 메서드를 통해서만 조회하도록 허용한다. public static SingletonService getInstance() { return instance; } // 3. 생성자를 private으로 선언해서 외부에서 new 키워드를 사용한 객체 생성을 못하게 막는다. private SingletonService() { } public void logic() { System.out.println(\"싱글톤 객체 로직 호출\"); } } 2.2 스프링 컨테이너가 싱글톤인지 확인하기 앞서 스프링 컨테이너가 싱글톤 방식을 사용한다고 했는데, 직접 확인해보자. 스프링에서 사용하는 객체 호출 방식을 사용해보자.\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 @Test @DisplayName(\"스프링 컨테이너와 싱글톤\") void springContainer() { ApplicationContext ac = new AnnotationConfigApplicationContext(AppConfig.class); //1. 조회: 호출할 때 마다 같은 객체를 반환 MemberService memberService1 = ac.getBean(\"memberService\", MemberService.class); //2. 조회: 호출할 때 마다 같은 객체를 반환 MemberService memberService2 = ac.getBean(\"memberService\", MemberService.class); //참조값이 같은 것을 확인 System.out.println(\"memberService1 = \" + memberService1); System.out.println(\"memberService2 = \" + memberService2); //memberService1 == memberService2 assertThat(memberService1).isSameAs(memberService2); } 출력 결과\n1 2 3 memberService1 = SpringBasic.core.member.MemberServiceImpl@5c2375a9 memberService2 = SpringBasic.core.member.MemberServiceImpl@5c2375a9 스프링 컨테이너는 객체를 하나만 생성해서 계속해서 사용하는 것을 확인할 수 있다.\n2.3 싱글톤 사용 시 단점과 해결책 싱글톤 레지스트리(singleton registry) 디자인 패턴을 적용해 해결한다.\n그러면 위 코드를 봤을 때 싱글톤의 단점을 정리해보자.\n이 패턴을 구현하기 위해 코드 품이 많이 든다. 위 클래스 변수처럼 인터페이스가 아닌 구현체에 의존하므로 DIP와 OCP를 위반한다. private 생성자로 자식 클래스를 만들기 어렵다. 싱글톤은 테스트용 객체를 생성할 수 없기 때문에 테스트가 어렵다. 무엇보다 하나의 객체를 여러 객체에서 사용하기 때문에 상태 유지(stateful)로 설계할 경우, 의도치 않은 값을 얻을 수 있다. 스프링에서는 이 단점을 어떻게 해결하는지 알아보자. 스프링에서는 앞서 스프링 빈으로 확인했을 때 다음 사항을 확인할 수 있다.\n싱글톤으로 코드를 입력하지 않아도, DIP와 OCP 위반 없이, private 생성자로부터 자유롭게, 테스트 코드로도, 싱글톤이 사용되는 것을 확인할 수 있다.\n어떻게 이게 가능한 것일까?\n스프링 컨테이너가 ‘싱글톤 레지스트리(singleton registry) 패턴’ 방식이기 때문에 가능하다. 싱글톤과 레지스트리는 디자인 패턴의 각각 한 종류다. 싱글톤은 앞서 언급했으니 넘어가면 레지스트리는 객체를 전역적으로 관리하고 제공하는 디자인 패턴을 의미한다. 중앙 저장소(레지스트리)를 통해 객체를 관리하고 필요할 때 조회해 사용하는 방식이라는 의미다. 그래서 싱글톤과 레지스트리 두 가지 패턴을 합쳐서 만든 것이 스프링 컨테이너이다.\n즉, 스프링 빈을 싱글톤으로 관리하는 저장소라는 의미다. 스프링 컨테이너인 ApplicationContext은 Bean이 이미 존재하면 기존에 있던 것을 사용하고, 없으면 새로 생성해서 등록하는 방식을 사용하기 때문에 각 Bean을 싱글톤으로 유지하면서, 싱글톤으로 발생되는 위 4가지 문제점을 해결할 수 있다.\n2.4 아직 해결되지 않은 문제: stateful 필드를 없애는 방향으로 진행하자.\n아직 stateful 문제는 해결되지 않았다. 하나의 객체 인스턴스를 공유하기 때문에 싱글톤 객체는 상태를 유지하게 설계하면 안된다. 무상태로 설계 해야 한다. 이 말은 다음 내용을 의미한다.\n특정 클라이언트에 의존적인 필드가 있으면 안된다. 특정 클라이언트가 값을 변경할 수 있는 필드가 있으면 안된다. 가급적 읽기만 가능해야 한다. 필드 대신 자바에서 공유되지 않는 지역 변수, 파라미터, ThreadLocal 등을 사용해야 한다. 싱글톤으로 공유하는 객체에 수량을 의미하는 amount 필드가 있다고 할 때, A 클라이언트가 이 amount에 10을 저장한다. 그 다음, B 클라이언트가 바로 13을 저장한다. 그후, A 클라이언트가 amount 값을 조회할 때 10이 나와야 하지만, 13이 나오는 문제점이 생긴다.\n그래서 필드를 없애는 방향으로 진행해야 한다.\n2.5 @Configuration에서 싱글톤이 유지되는 이유 바이트코드 조작 라이브러리 때문에 유지가 된다.\n싱글톤 개념에 대해서 알았으니 다시 AppConfig를 확인해보자. 각 메서드가 몇 번 호출되었는지 확인하기 위해 출력 함수로 로그를 추가한다.\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 // AppConfig.java @Configuration public class AppConfig { @Bean public MemberService memberService() { System.out.println(\"call AppConfig.memberService\"); return new MemberServiceImpl(memberRepository()); } @Bean public OrderService orderService() { System.out.println(\"Call AppConfig.orderService\"); return new OrderServiceImpl(memberRepository(), discountPolicy()); } @Bean public MemberRepository memberRepository() { System.out.println(\"Call AppConfig.memberRepository\"); return new MemoryMemberRepository(); } @Bean public DiscountPolicy discountPolicy() { System.out.println(\"Call AppConfig.discountPolicy\"); return new RateDiscountPolicy(); } } 만약 스프링 빈이 생성된다면 MemberRepository는 몇 번 호출될까?\nMemberService에서 한 번 OrderService에서 한 번 마지막 memberRepository에서 한 번 memberRepository가 총 3번이 호출되어 나는 다음 순서로 호출될 것이라 예상했다.\n1 2 3 4 5 6 7 call AppConfig.memberSerivce -\u003e memberService에 의한 호출 call AppConfig.memberRepository -\u003e memberService에 의한 호출 call AppConfig.orderService -\u003e orderService에 의한 호출 call AppConfig.memberRepository -\u003e orderService에 의한 호출 call AppConfig.discountPoilcy -\u003e orderService에 의한 호출 call AppConfig.memberRepository -\u003e memberRepository 의한 호출 call AppConfig.discountPoilcy -\u003e discountPoilcy 의한 호출 하지만 바로 밑의 결과처럼 다른 결과를 확인할 수 있다.\n1 2 3 4 call AppConfig.memberService call AppConfig.memberRepository call AppConfig.orderService call AppConfig.discountPoilcy 어째서 그런 것일까? 아래 코드를 확인해보자.\n테스트 코드\n1 2 3 4 5 6 7 8 @Test void configurationTest() { ApplicationContext ac = new AnnotationConfigApplicationContext(AppConfig.class); AppConfig appConfig = ac.getBean(AppConfig.class); System.out.println(\"AppConfig를 getBean으로 가져온 경우: \" + appConfig); System.out.println(\"AppConfig를 바로 조회한 경우: \" + AppConfig.class); } 결과\n1 2 AppConfig를 getBean으로 가져온 경우: SpringBasic.core.AppConfig$$SpringCGLIB$$0@7a55af6b AppConfig를 바로 조회한 경우: class SpringBasic.core.AppConfig ac는 @Configuration을 추가해 스프링 빈으로 등록된 객체다. 하지만 순수한 자바 객체로서의 스프링 빈이 아니다. ‘CGLIB’라는 바이트코드 조작 라이브러리를 사용해 @Configuration이 붙은 클래스를 상속받는 클래스를 만들고, 이 클래스 객체를 등록한 것이다. 그래서 CGLIB 라는 문자를 확인할 수 있다.\n이 바이트코드 조작 라이브러리가 스프링 빈을 싱글톤으로 작동되도록 보장한다.\n예를 들어 @Bean이 붙은 메서드마다 스프링 빈 저장소에 해당 빈 이름이 이미 존재한다면 생성하지 않는다. 없다면 생성 후 컨테이너에 등록한다.\n만약 @Configuration 없이 @Bean만 적용하면 스프링 빈으로는 등록이 되지만, 싱글톤으로 유지되지 않는다.\n호출 결과 call AppConfig.memberService call AppConfig.memberRepository call AppConfig.orderService call AppConfig.memberRepository call AppConfig.memberRepository 그래서 항상 스프링 설정 정보는 @Configuration을 사용하자.\nReference 스프링 MVC 1편 - 백엔드 웹 개발 핵심 기술 Introduction to the Spring IoC Container and Beans ","wordCount":"1814","inLanguage":"en","datePublished":"2024-12-15T04:28:22+09:00","dateModified":"2024-12-15T04:28:22+09:00","author":[{"@type":"Person","name":"Me"}],"mainEntityOfPage":{"@type":"WebPage","@id":"http://jeha00.github.io/post/spring/study_1/"},"publisher":{"@type":"Organization","name":"Jeha DevLog","logo":{"@type":"ImageObject","url":"http://jeha00.github.io/favicon.ico"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=http://jeha00.github.io/ accesskey=h title="@Jeha00 (Alt + H)">@Jeha00</a>
<span class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></span></div><ul id=menu><li><a href=http://jeha00.github.io/me/ title=About><span>About</span></a></li><li><a href=http://jeha00.github.io/archives/ title=Archive><span>Archive</span></a></li><li><a href=http://jeha00.github.io/categories/ title=Categories><span>Categories</span></a></li><li><a href=http://jeha00.github.io/search/ title="Search (Alt + /)" accesskey=/><span>Search</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=http://jeha00.github.io/>Home</a>&nbsp;»&nbsp;<a href=http://jeha00.github.io/post/>Posts</a></div><h1 class=post-title>스프링 컨테이너, 스프링 빈, 싱글톤 레지스트리란?</h1><div class=post-meta>Spring&nbsp;·&nbsp;<span title='2024-12-15 04:28:22 +0900 KST'>December 15, 2024</span>&nbsp;·&nbsp;Me</div></header><div class=toc><details><summary accesskey=c title="(Alt + C)"><span class=details>Table of Contents</span></summary><div class=inner><ul><li><a href=#1-%ec%8a%a4%ed%94%84%eb%a7%81-%ec%bb%a8%ed%85%8c%ec%9d%b4%eb%84%88%ec%99%80-%ec%8a%a4%ed%94%84%eb%a7%81-%eb%b9%88 aria-label="1. 스프링 컨테이너와 스프링 빈">1. 스프링 컨테이너와 스프링 빈</a><ul><li><a href=#11-%ec%8a%a4%ed%94%84%eb%a7%81-%ec%bb%a8%ed%85%8c%ec%9d%b4%eb%84%88%ec%99%80-%ec%8a%a4%ed%94%84%eb%a7%81-%eb%b9%88%ec%9d%b4%eb%9e%80 aria-label="1.1 스프링 컨테이너와 스프링 빈이란?">1.1 스프링 컨테이너와 스프링 빈이란?</a></li><li><a href=#12-%ec%8a%a4%ed%94%84%eb%a7%81-%eb%b9%88-%ec%83%9d%ec%84%b1-%eb%b0%8f-%eb%93%b1%eb%a1%9d-%ea%b3%bc%ec%a0%95 aria-label="1.2 스프링 빈 생성 및 등록 과정">1.2 스프링 빈 생성 및 등록 과정</a></li><li><a href=#13-%ec%8a%a4%ed%94%84%eb%a7%81-%ec%bb%a8%ed%85%8c%ec%9d%b4%eb%84%88%ec%9d%98-%ec%bd%94%eb%93%9c-%ea%b5%ac%ec%a1%b0 aria-label="1.3 스프링 컨테이너의 코드 구조">1.3 스프링 컨테이너의 코드 구조</a></li><li><a href=#14-beandefinition aria-label="1.4 BeanDefinition">1.4 BeanDefinition</a></li><li><a href=#15-%ec%8a%a4%ed%94%84%eb%a7%81-%eb%b9%88-%ec%a1%b0%ed%9a%8c%ed%95%98%ea%b8%b0 aria-label="1.5 스프링 빈 조회하기">1.5 스프링 빈 조회하기</a></li></ul></li><li><a href=#2-%ec%8b%b1%ea%b8%80%ed%86%a4-%eb%a0%88%ec%a7%80%ec%8a%a4%ed%8a%b8%eb%a6%ac aria-label="2. 싱글톤 레지스트리">2. 싱글톤 레지스트리</a><ul><li><a href=#21-%ec%8b%b1%ea%b8%80%ed%86%a4-%ed%8c%a8%ed%84%b4%ec%9d%b4%eb%9e%80 aria-label="2.1 싱글톤 패턴이란?">2.1 싱글톤 패턴이란?</a></li><li><a href=#22-%ec%8a%a4%ed%94%84%eb%a7%81-%ec%bb%a8%ed%85%8c%ec%9d%b4%eb%84%88%ea%b0%80-%ec%8b%b1%ea%b8%80%ed%86%a4%ec%9d%b8%ec%a7%80-%ed%99%95%ec%9d%b8%ed%95%98%ea%b8%b0 aria-label="2.2 스프링 컨테이너가 싱글톤인지 확인하기">2.2 스프링 컨테이너가 싱글톤인지 확인하기</a></li><li><a href=#23-%ec%8b%b1%ea%b8%80%ed%86%a4-%ec%82%ac%ec%9a%a9-%ec%8b%9c-%eb%8b%a8%ec%a0%90%ea%b3%bc-%ed%95%b4%ea%b2%b0%ec%b1%85 aria-label="2.3 싱글톤 사용 시 단점과 해결책">2.3 싱글톤 사용 시 단점과 해결책</a></li><li><a href=#24-%ec%95%84%ec%a7%81-%ed%95%b4%ea%b2%b0%eb%90%98%ec%a7%80-%ec%95%8a%ec%9d%80-%eb%ac%b8%ec%a0%9c-stateful aria-label="2.4 아직 해결되지 않은 문제: stateful">2.4 아직 해결되지 않은 문제: stateful</a></li><li><a href=#25-configuration%ec%97%90%ec%84%9c-%ec%8b%b1%ea%b8%80%ed%86%a4%ec%9d%b4-%ec%9c%a0%ec%a7%80%eb%90%98%eb%8a%94-%ec%9d%b4%ec%9c%a0 aria-label="2.5 @Configuration에서 싱글톤이 유지되는 이유">2.5 @Configuration에서 싱글톤이 유지되는 이유</a></li></ul></li><li><a href=#reference aria-label=Reference>Reference</a></li></ul></div></details></div><div class=post-content><h1 id=1-스프링-컨테이너와-스프링-빈>1. 스프링 컨테이너와 스프링 빈<a hidden class=anchor aria-hidden=true href=#1-스프링-컨테이너와-스프링-빈>#</a></h1><hr><h2 id=11-스프링-컨테이너와-스프링-빈이란>1.1 스프링 컨테이너와 스프링 빈이란?<a hidden class=anchor aria-hidden=true href=#11-스프링-컨테이너와-스프링-빈이란>#</a></h2><p>스프링 컨테이너(Spring Container)란 IoC(제어의 역전, Inversion Of Control)와 DI
(의존관계 주입, Dependency Injection)를 구현하기 위해 설계된 역할로, <strong><em>개발자 대신 스프링 프레임워크가(IoC) 의존 관계 객체를 스프링 빈(Spring Bean) 객체로 생성하고 주입(DI)하고, 관리까지 전체적으로 담당해 객체 지향 프로그래밍을 위해 만들어진 도구다.</em></strong> 개발자가 직접하면 생성과 실행이 합쳐서 OCP, SRP가 깨지기 때문이다.</p><p>위 개념에서 언급한 스프링 빈(Spring Bean)은 스프링 컨테이너에 저장된 객체를 의미한다. 스프링이 판단해서 스프링 빈으로 적절한 의존 관계가 주입된다.</p><p>이 스프링 컨테이너 역할은 코드 상으로 BeanFactory 인터페이스를 통해 구현한다. 하지만 보통 BeanFactory 인터페이스를 상속받는 ApplicationContext 객체를 스프링 컨테이너라 부른다.</p><p>스프링 빈(Spring Bean)은 <code>@Configuration</code> 애노케이션이 붙은 객체의 메서드 중 <code>@Bean</code> 애노테이션이 붙은 메서드의 호출 결과로 생성된 객체를 의미한다.</p><ul><li>ApplicationContext (스프링 컨테이너)<ul><li><code>@Configuration</code><ul><li><code>@Bean</code></li></ul></li></ul></li></ul><p>필요한 객체가 있으면 스프링 컨테이너가 스프링 빈으로 등록된 객체들에서 찾아 의존성 주입을 한다.</p><h2 id=12-스프링-빈-생성-및-등록-과정>1.2 스프링 빈 생성 및 등록 과정<a hidden class=anchor aria-hidden=true href=#12-스프링-빈-생성-및-등록-과정>#</a></h2><p>스프링 컨테이너가 빈을 생성 및 등록하는 과정은 다음과 같다.</p><p>첫 번째, 스프링 컨테이너 인터페이스에 <code>@Configuration</code> 애노케이션이 붙은 객체의 Class 정보를 전달해, 해당 구성 정보를 가지고 있는 스프링 컨테이너를 생성한다.</p><ul><li>스프링 컨테이너에는 Map 타입으로 &lsquo;빈 이름&rsquo;과 &lsquo;빈 객체&rsquo;를 사상하여 저장한다.</li><li>설정 정보 객체</li></ul><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#a6e22e>@Configuration</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>AppConfig</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>	<span style=color:#f92672>...</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span></code></pre></td></tr></table></div></div><ul><li>스프링 컨테이너 생성</li></ul><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span>ApplicationContext applicationContext <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> AnnotationConfigApplicationContext<span style=color:#f92672>(</span>AppConfig<span style=color:#f92672>.</span><span style=color:#a6e22e>class</span><span style=color:#f92672>);</span>
</span></span></code></pre></td></tr></table></div></div><p>두 번째, 이 설정 정보 객체(ex: AppConfig)에 <code>@Bean</code> 데코레이션이 존재하는 메서드를 실행해 메서드의 이름을 &lsquo;Bean 이름&rsquo;으로 하고, 메서드의 반환값으로 생신 객체를 &lsquo;Bean&rsquo;으로 저장한다. 이 때 빈 이름은 중복되면 안된다.</p><p>세 번째, 그후, 설정 정보를 참고해 의존관계를 주입(DI)한다.</p><h2 id=13-스프링-컨테이너의-코드-구조>1.3 스프링 컨테이너의 코드 구조<a hidden class=anchor aria-hidden=true href=#13-스프링-컨테이너의-코드-구조>#</a></h2><blockquote><p><em>코드에서 ApplicationContext 타입을 클릭해서 들어가면 다음 내용을 확인할 수 있다.</em></p></blockquote><p>스프링 컨테이너라 불리는 두 객체(BeanFactory와 ApplicationContext)는 인터페이스(interface)이고, ApplicationContext는 BeanFactory를 상속받는다. 그래서 BeanFactory는 스프링 컨테이너의 최상위 인터페이스다.</p><p>BeanFactory는 Bean을 조회할 때 사용하는 getBean() 메서드를 제공하는 역할을 수행한다.
ApplicationContext는 이 BeanFactory를 상속받기 때문에 이 메서드를 사용할 수 있으면서
다양한 인터페이스를 상속받는다.</p><p>ApplicationContext의 소스 코드를 보면 BeanFactory 인터페이스를 바로 찾을 수 없다.</p><p>BeanFactory 인터페이스는 이 인터페이스를 상속받는 다른 인터페이스를 통해 제공된다. 바로 ListableBeanFactory, HierarchicalBeanFactory 이 두 인터페이스다.</p><ul><li>ListableBeanFactory는 빈을 조회하는데 사용되는 다양한 메서드를 제공한다.</li><li>HierarchicalBeanFactory는 특정 빈이 존재하는지 확인하는데 사용된다.</li></ul><p>그 밖에 다양한 인터페이스를 상속받는다.</p><ul><li>MessageSource: 국제화 기능(한국에서는 한국어로, 영어권에서는 영어로)</li><li>EnvironmentCapable: 로컬, 개발, 운영 등 구분</li><li>ApplicationEventPublisher: 이벤트 발행 및 구독</li><li>ResourceLoader: 외부 리소스 조회</li></ul><p>그리고 스프링의 설정 정보는 java외에도 Xml 형식으로도 가능하고, 그 외 다양한 형식으로 전달할 수 있다.
<code>@Configuration</code> 처럼 어노테이션 방식으로 전달할 때는 <code>AnnotationConfigApplicationContext</code>를 통해서 전달받는다.
그러면 <code>AnnotatedBeanDefinitionReader</code>에 의해 설정 정보를 읽고, 빈의 메타 정보인 <code>BeanDefinition</code>을 생성한다.</p><p><code>AnnotationConfigApplicationContext</code> 객체의 소스 코드다.</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">15
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">16
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">17
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">18
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#75715e>// 소스 코드
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>AnnotationConfigApplicationContext</span> <span style=color:#66d9ef>extends</span> GenericApplicationContext <span style=color:#66d9ef>implements</span> AnnotationConfigRegistry <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>final</span> AnnotatedBeanDefinitionReader reader<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>final</span> ClassPathBeanDefinitionScanner scanner<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#f92672>...</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>public</span> <span style=color:#a6e22e>AnnotationConfigApplicationContext</span><span style=color:#f92672>(</span>Class<span style=color:#f92672>&lt;?&gt;...</span> componentClasses<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>this</span><span style=color:#f92672>();</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>this</span><span style=color:#f92672>.</span><span style=color:#a6e22e>register</span><span style=color:#f92672>(</span>componentClasses<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>this</span><span style=color:#f92672>.</span><span style=color:#a6e22e>refresh</span><span style=color:#f92672>();</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>public</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>register</span><span style=color:#f92672>(</span>Class<span style=color:#f92672>&lt;?&gt;...</span> componentClasses<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>		<span style=color:#f92672>...</span>
</span></span><span style=display:flex><span>		<span style=color:#66d9ef>this</span><span style=color:#f92672>.</span><span style=color:#a6e22e>reader</span><span style=color:#f92672>.</span><span style=color:#a6e22e>register</span><span style=color:#f92672>(</span>componentClasses<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>	<span style=color:#f92672>}</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span></code></pre></td></tr></table></div></div><p>밑에는 <code>AnnotatedBeanDefinitionReader</code>의 소스 코드다.</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">15
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">16
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">17
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">18
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">19
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">20
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#75715e>// 소스 코드
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>AnnotatedBeanDefinitionReader</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>final</span> BeanDefinitionRegistry registry<span style=color:#f92672>;</span> <span style=color:#75715e>// Bean 메타 정보 저장소
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>
</span></span><span style=display:flex><span>	<span style=color:#f92672>...</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>register</span><span style=color:#f92672>(</span>Class<span style=color:#f92672>&lt;?&gt;...</span> componentClasses<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        Class<span style=color:#f92672>[]</span> var2 <span style=color:#f92672>=</span> componentClasses<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>int</span> var3 <span style=color:#f92672>=</span> componentClasses<span style=color:#f92672>.</span><span style=color:#a6e22e>length</span><span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>for</span><span style=color:#f92672>(</span><span style=color:#66d9ef>int</span> var4 <span style=color:#f92672>=</span> 0<span style=color:#f92672>;</span> var4 <span style=color:#f92672>&lt;</span> var3<span style=color:#f92672>;</span> <span style=color:#f92672>++</span>var4<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>            Class<span style=color:#f92672>&lt;?&gt;</span> componentClass <span style=color:#f92672>=</span> var2<span style=color:#f92672>[</span>var4<span style=color:#f92672>];</span>
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>this</span><span style=color:#f92672>.</span><span style=color:#a6e22e>registerBean</span><span style=color:#f92672>(</span>componentClass<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>public</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>registerBean</span><span style=color:#f92672>(</span>Class<span style=color:#f92672>&lt;?&gt;</span> beanClass<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>		<span style=color:#66d9ef>this</span><span style=color:#f92672>.</span><span style=color:#a6e22e>doRegisterBean</span><span style=color:#f92672>(</span>beanClass<span style=color:#f92672>,</span> <span style=color:#f92672>...)</span>
</span></span><span style=display:flex><span>	<span style=color:#f92672>}</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span></code></pre></td></tr></table></div></div><h2 id=14-beandefinition>1.4 BeanDefinition<a hidden class=anchor aria-hidden=true href=#14-beandefinition>#</a></h2><p>스프링 컨테이너의 설정 정보는 자바 클래스 외에 xml을 사용해서도 생성할 수 있다. 다양한 방법으로 설정 정보를 가질 수 있는 이유는 여기서도 객체 지향의 원리는 역할과 구현을 구분했기 때문이다.</p><p>스프링 컨테이너에 스프링 빈 같은 설정 정보는 <code>BeanDefinition</code>이라는 인터페이스에 의존한다.</p><ul><li>빈 설정에 대한 메타 정보이다.</li><li>경로는 <code>package org.springframework.beans.factory.config</code>에 존재한다.</li><li><code>@Bean</code>마다 메타 정보가 하나씩 생성된다.</li><li>이 정보를 기반으로 스프링 컨테이너에 스프링 빈이 생성 및 등록된다.</li></ul><p><code>AnnotationConfigApplicationContext</code> 는 <code>AnnotatedBeanDefinitionReader</code> 를 사용해서 <code>AppConfig.class</code> 를 읽고 <code>BeanDefinition</code> 을 생성한다.</p><p>BeanDefinition에 대해서는 너무 깊이있게 이해하기 보다는, 스프링이 다양한 형태의 설정 정보를 BeanDefinition으로 추상화해서 사용하는 것 정도만 이해하면 된다.</p><h2 id=15-스프링-빈-조회하기>1.5 스프링 빈 조회하기<a hidden class=anchor aria-hidden=true href=#15-스프링-빈-조회하기>#</a></h2><p>등록된 빈도 조회할 수 있다.</p><ul><li>case 1: Bean 객체로 조회할 수 있다. (getBean(빈 객체 클래스 정보))<ul><li>getBean(MemberService.class)</li></ul></li><li>case 2: 만약 해당 Bean 객체로 된 것이 두 개 이상이면 Bean 객체와 Bean 이름을 함께 사용해 Bean을 조회하면 된다. (getBean(빈 이름, 빈 객체 클래스 정보))</li><li>case 3: 조회하는 빈 객체에 여러 자식들이 존재하면 자식들까지 가져온다.(getBeansOfType(특정 타입의 빈 클래스 정보))</li><li>case 4: 만약 특정 자식을 조회하고 싶으면 빈 이름을 사용하면 된다. (case2)</li></ul><p> </p><h1 id=2-싱글톤-레지스트리>2. 싱글톤 레지스트리<a hidden class=anchor aria-hidden=true href=#2-싱글톤-레지스트리>#</a></h1><hr><h2 id=21-싱글톤-패턴이란>2.1 싱글톤 패턴이란?<a hidden class=anchor aria-hidden=true href=#21-싱글톤-패턴이란>#</a></h2><blockquote><p><em>해당 객체를 서버에서 1개만 생성해 공유해서 사용하도록 설계하는 패턴</em></p></blockquote><p>스프링 컨테이너는 싱글톤 방식을 사용한다. 그러면 왜 싱글톤 방식을 사용하는지 이해하기 위해, 이 방식을 사용하지 않을 경우 발생되는 문제점에 대해 알아보자.</p><p>만약 스프링 빈을 사용하는 것 없이 AppConfig의 설정 객체를 가져오려면 AppConfig의 인스턴스를 통해서 메서드를 실행하면 된다.</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#66d9ef>void</span> <span style=color:#a6e22e>pureContainer</span><span style=color:#f92672>()</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	AppConfig appConfig <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> AppConfig<span style=color:#f92672>();</span>
</span></span><span style=display:flex><span>	<span style=color:#75715e>//1. 조회: 호출할 때 마다 객체를 생성
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>	MemberService memberService1 <span style=color:#f92672>=</span> appConfig<span style=color:#f92672>.</span><span style=color:#a6e22e>memberService</span><span style=color:#f92672>();</span>
</span></span><span style=display:flex><span>	<span style=color:#75715e>//2. 조회: 호출할 때 마다 객체를 생성
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>	MemberService memberService2 <span style=color:#f92672>=</span> appConfig<span style=color:#f92672>.</span><span style=color:#a6e22e>memberService</span><span style=color:#f92672>();</span>
</span></span><span style=display:flex><span>	<span style=color:#75715e>//참조값이 다른 것을 확인
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>	System<span style=color:#f92672>.</span><span style=color:#a6e22e>out</span><span style=color:#f92672>.</span><span style=color:#a6e22e>println</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;memberService1 = &#34;</span> <span style=color:#f92672>+</span> memberService1<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>	System<span style=color:#f92672>.</span><span style=color:#a6e22e>out</span><span style=color:#f92672>.</span><span style=color:#a6e22e>println</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;memberService2 = &#34;</span> <span style=color:#f92672>+</span> memberService2<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>	<span style=color:#75715e>//memberService1 != memberService2
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>	assertThat<span style=color:#f92672>(</span>memberService1<span style=color:#f92672>).</span><span style=color:#a6e22e>isNotSameAs</span><span style=color:#f92672>(</span>memberService2<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span></code></pre></td></tr></table></div></div><p>각 메서드의 실행 결과 다음 객체를 새로 생성해서 반환한다.</p><ul><li>MemberService</li><li>OrderService</li><li>MemberRepository</li><li>DiscountPolicy</li></ul><p><strong><em>만약 웹 애플리케이션이라면 request 요청이 들어올 때마다 이 서비스 객체를 호출한다면 매번 새로운 객체가 생성된다. 그러면 한 번 사용하고 사용되지 않으면 해당 서비스 객체는 GC에 의해 반복적으로 삭제된다. 이 방식은 &lsquo;메모리 낭비가 심하다&rsquo;는 단점이 존재한다.</em></strong></p><p><strong><em>그래서 이에 대한 해결책이 해당 객체를 서버에서 1개만 생성해 공유해서 사용하도록 설계한다. 이러한 패턴을 &lsquo;싱글톤(singleton) 패턴&rsquo;이라 한다. 이러한 싱글톤 패턴의 특징 때문에 객체 인스턴스를 2개 이상 생성하지 못하도록 막아야 하므로 생성자의 접근 제어자를 반드시 <code>private</code>로 지정해야 한다.</em></strong></p><p>만약 싱글톤으로 사용되어야 하는 객체가 있다면 다음과 같이 코드를 구성하면 된다.</p><ul><li>클래스 변수로 단 하나의 인스턴스만 사용되고, 외부에서 접근하지 못하도록 <code>private static final</code>을 지정한다.</li><li>해당 객체를 사용하고 싶으면 특정 메서드를 통해서만 접근하도록 한다.</li></ul><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">15
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">16
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>SingletonService</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>	<span style=color:#75715e>//1. static 영역에 객체를 딱 1개만 생성해둔다.
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>	<span style=color:#66d9ef>private</span> <span style=color:#66d9ef>static</span> <span style=color:#66d9ef>final</span> SingletonService instance <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> SingletonService<span style=color:#f92672>();</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#75715e>//2. public으로 열어서 객체 인스턴스가 필요하면 이 static 메서드를 통해서만 조회하도록 허용한다.
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>static</span> SingletonService <span style=color:#a6e22e>getInstance</span><span style=color:#f92672>()</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> instance<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>	<span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>// 3. 생성자를 private으로 선언해서 외부에서 new 키워드를 사용한 객체 생성을 못하게 막는다.
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#66d9ef>private</span> <span style=color:#a6e22e>SingletonService</span><span style=color:#f92672>()</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>public</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>logic</span><span style=color:#f92672>()</span> <span style=color:#f92672>{</span> System<span style=color:#f92672>.</span><span style=color:#a6e22e>out</span><span style=color:#f92672>.</span><span style=color:#a6e22e>println</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;싱글톤 객체 로직 호출&#34;</span><span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>	<span style=color:#f92672>}</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span></code></pre></td></tr></table></div></div><h2 id=22-스프링-컨테이너가-싱글톤인지-확인하기>2.2 스프링 컨테이너가 싱글톤인지 확인하기<a hidden class=anchor aria-hidden=true href=#22-스프링-컨테이너가-싱글톤인지-확인하기>#</a></h2><p>앞서 스프링 컨테이너가 싱글톤 방식을 사용한다고 했는데, 직접 확인해보자. 스프링에서 사용하는 객체 호출 방식을 사용해보자.</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">15
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">16
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">17
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#a6e22e>@Test</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>@DisplayName</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;스프링 컨테이너와 싱글톤&#34;</span><span style=color:#f92672>)</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>void</span> <span style=color:#a6e22e>springContainer</span><span style=color:#f92672>()</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>	ApplicationContext ac <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span>
</span></span><span style=display:flex><span> AnnotationConfigApplicationContext<span style=color:#f92672>(</span>AppConfig<span style=color:#f92672>.</span><span style=color:#a6e22e>class</span><span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>	<span style=color:#75715e>//1. 조회: 호출할 때 마다 같은 객체를 반환
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>	MemberService memberService1 <span style=color:#f92672>=</span> ac<span style=color:#f92672>.</span><span style=color:#a6e22e>getBean</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;memberService&#34;</span><span style=color:#f92672>,</span>
</span></span><span style=display:flex><span> MemberService<span style=color:#f92672>.</span><span style=color:#a6e22e>class</span><span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>	<span style=color:#75715e>//2. 조회: 호출할 때 마다 같은 객체를 반환
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>	MemberService memberService2 <span style=color:#f92672>=</span> ac<span style=color:#f92672>.</span><span style=color:#a6e22e>getBean</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;memberService&#34;</span><span style=color:#f92672>,</span>
</span></span><span style=display:flex><span> MemberService<span style=color:#f92672>.</span><span style=color:#a6e22e>class</span><span style=color:#f92672>);</span>
</span></span><span style=display:flex><span><span style=color:#75715e>//참조값이 같은 것을 확인
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>	System<span style=color:#f92672>.</span><span style=color:#a6e22e>out</span><span style=color:#f92672>.</span><span style=color:#a6e22e>println</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;memberService1 = &#34;</span> <span style=color:#f92672>+</span> memberService1<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>	System<span style=color:#f92672>.</span><span style=color:#a6e22e>out</span><span style=color:#f92672>.</span><span style=color:#a6e22e>println</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;memberService2 = &#34;</span> <span style=color:#f92672>+</span> memberService2<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>	<span style=color:#75715e>//memberService1 == memberService2
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>	assertThat<span style=color:#f92672>(</span>memberService1<span style=color:#f92672>).</span><span style=color:#a6e22e>isSameAs</span><span style=color:#f92672>(</span>memberService2<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span> <span style=color:#f92672>}</span>
</span></span></code></pre></td></tr></table></div></div><ul><li><p>출력 결과</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span>
</span></span><span style=display:flex><span>memberService1 <span style=color:#f92672>=</span> SpringBasic<span style=color:#f92672>.</span><span style=color:#a6e22e>core</span><span style=color:#f92672>.</span><span style=color:#a6e22e>member</span><span style=color:#f92672>.</span><span style=color:#a6e22e>MemberServiceImpl</span><span style=color:#a6e22e>@5c2375a9</span>
</span></span><span style=display:flex><span>memberService2 <span style=color:#f92672>=</span> SpringBasic<span style=color:#f92672>.</span><span style=color:#a6e22e>core</span><span style=color:#f92672>.</span><span style=color:#a6e22e>member</span><span style=color:#f92672>.</span><span style=color:#a6e22e>MemberServiceImpl</span><span style=color:#a6e22e>@5c2375a9</span>
</span></span></code></pre></td></tr></table></div></div></li></ul><p><strong><em>스프링 컨테이너는 객체를 하나만 생성해서 계속해서 사용하는 것을 확인할 수 있다.</em></strong></p><h2 id=23-싱글톤-사용-시-단점과-해결책>2.3 싱글톤 사용 시 단점과 해결책<a hidden class=anchor aria-hidden=true href=#23-싱글톤-사용-시-단점과-해결책>#</a></h2><blockquote><p><em>싱글톤 레지스트리(singleton registry) 디자인 패턴을 적용해 해결한다.</em></p></blockquote><p>그러면 위 코드를 봤을 때 싱글톤의 단점을 정리해보자.</p><ol><li>이 패턴을 구현하기 위해 코드 품이 많이 든다.</li><li>위 클래스 변수처럼 인터페이스가 아닌 구현체에 의존하므로 DIP와 OCP를 위반한다.</li><li>private 생성자로 자식 클래스를 만들기 어렵다.</li><li>싱글톤은 테스트용 객체를 생성할 수 없기 때문에 테스트가 어렵다.</li><li><strong><em>무엇보다 하나의 객체를 여러 객체에서 사용하기 때문에 상태 유지(stateful)로 설계할 경우, 의도치 않은 값을 얻을 수 있다.</em></strong></li></ol><p>스프링에서는 이 단점을 어떻게 해결하는지 알아보자. 스프링에서는 앞서 스프링 빈으로 확인했을 때 다음 사항을 확인할 수 있다.</p><ol><li>싱글톤으로 코드를 입력하지 않아도,</li><li>DIP와 OCP 위반 없이,</li><li>private 생성자로부터 자유롭게,</li><li>테스트 코드로도,</li></ol><p>싱글톤이 사용되는 것을 확인할 수 있다.</p><p>어떻게 이게 가능한 것일까?</p><p><strong><em>스프링 컨테이너가 &lsquo;싱글톤 레지스트리(singleton registry) 패턴&rsquo; 방식이기 때문에 가능하다.</em></strong> 싱글톤과 레지스트리는 디자인 패턴의 각각 한 종류다. 싱글톤은 앞서 언급했으니 넘어가면 레지스트리는 객체를 전역적으로 관리하고 제공하는 디자인 패턴을 의미한다. 중앙 저장소(레지스트리)를 통해 객체를 관리하고 필요할 때 조회해 사용하는 방식이라는 의미다. 그래서 싱글톤과 레지스트리 두 가지 패턴을 합쳐서 만든 것이 스프링 컨테이너이다.</p><p>즉, 스프링 빈을 싱글톤으로 관리하는 저장소라는 의미다. 스프링 컨테이너인 ApplicationContext은 Bean이 이미 존재하면 기존에 있던 것을 사용하고, 없으면 새로 생성해서 등록하는 방식을 사용하기 때문에 각 Bean을 싱글톤으로 유지하면서, 싱글톤으로 발생되는 위 4가지 문제점을 해결할 수 있다.</p><h2 id=24-아직-해결되지-않은-문제-stateful>2.4 아직 해결되지 않은 문제: stateful<a hidden class=anchor aria-hidden=true href=#24-아직-해결되지-않은-문제-stateful>#</a></h2><blockquote><p><em>필드를 없애는 방향으로 진행하자.</em></p></blockquote><p>아직 stateful 문제는 해결되지 않았다. 하나의 객체 인스턴스를 공유하기 때문에 싱글톤 객체는 상태를 유지하게 설계하면 안된다. 무상태로 설계 해야 한다. 이 말은 다음 내용을 의미한다.</p><ol><li>특정 클라이언트에 의존적인 필드가 있으면 안된다.</li><li>특정 클라이언트가 값을 변경할 수 있는 필드가 있으면 안된다.</li><li>가급적 읽기만 가능해야 한다.</li><li>필드 대신 자바에서 공유되지 않는 지역 변수, 파라미터, ThreadLocal 등을 사용해야 한다.</li></ol><p>싱글톤으로 공유하는 객체에 수량을 의미하는 amount 필드가 있다고 할 때, A 클라이언트가 이 amount에 10을 저장한다. 그 다음, B 클라이언트가 바로 13을 저장한다. 그후, A 클라이언트가 amount 값을 조회할 때 10이 나와야 하지만, 13이 나오는 문제점이 생긴다.</p><p>그래서 <strong><em>필드를 없애는 방향으로 진행해야 한다.</em></strong></p><h2 id=25-configuration에서-싱글톤이-유지되는-이유>2.5 @Configuration에서 싱글톤이 유지되는 이유<a hidden class=anchor aria-hidden=true href=#25-configuration에서-싱글톤이-유지되는-이유>#</a></h2><blockquote><p><em>바이트코드 조작 라이브러리 때문에 유지가 된다.</em></p></blockquote><p>싱글톤 개념에 대해서 알았으니 다시 AppConfig를 확인해보자. 각 메서드가 몇 번 호출되었는지 확인하기 위해 출력 함수로 로그를 추가한다.</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">15
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">16
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">17
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">18
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">19
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">20
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">21
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">22
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">23
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">24
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">25
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">26
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">27
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">28
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">29
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#75715e>// AppConfig.java
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>@Configuration</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>AppConfig</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@Bean</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> MemberService <span style=color:#a6e22e>memberService</span><span style=color:#f92672>()</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        System<span style=color:#f92672>.</span><span style=color:#a6e22e>out</span><span style=color:#f92672>.</span><span style=color:#a6e22e>println</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;call AppConfig.memberService&#34;</span><span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>new</span> MemberServiceImpl<span style=color:#f92672>(</span>memberRepository<span style=color:#f92672>());</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@Bean</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> OrderService <span style=color:#a6e22e>orderService</span><span style=color:#f92672>()</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        System<span style=color:#f92672>.</span><span style=color:#a6e22e>out</span><span style=color:#f92672>.</span><span style=color:#a6e22e>println</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;Call AppConfig.orderService&#34;</span><span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>new</span> OrderServiceImpl<span style=color:#f92672>(</span>memberRepository<span style=color:#f92672>(),</span> discountPolicy<span style=color:#f92672>());</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@Bean</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> MemberRepository <span style=color:#a6e22e>memberRepository</span><span style=color:#f92672>()</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        System<span style=color:#f92672>.</span><span style=color:#a6e22e>out</span><span style=color:#f92672>.</span><span style=color:#a6e22e>println</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;Call AppConfig.memberRepository&#34;</span><span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>new</span> MemoryMemberRepository<span style=color:#f92672>();</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@Bean</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> DiscountPolicy <span style=color:#a6e22e>discountPolicy</span><span style=color:#f92672>()</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        System<span style=color:#f92672>.</span><span style=color:#a6e22e>out</span><span style=color:#f92672>.</span><span style=color:#a6e22e>println</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;Call AppConfig.discountPolicy&#34;</span><span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>new</span> RateDiscountPolicy<span style=color:#f92672>();</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span></code></pre></td></tr></table></div></div><p>만약 스프링 빈이 생성된다면 <code>MemberRepository</code>는 몇 번 호출될까?</p><ul><li>MemberService에서 한 번</li><li>OrderService에서 한 번</li><li>마지막 memberRepository에서 한 번</li></ul><p>memberRepository가 총 3번이 호출되어 나는 다음 순서로 호출될 것이라 예상했다.</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">5
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">6
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">7
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text><span style=display:flex><span>call AppConfig.memberSerivce -&gt; memberService에 의한 호출
</span></span><span style=display:flex><span>call AppConfig.memberRepository -&gt; memberService에 의한 호출
</span></span><span style=display:flex><span>call AppConfig.orderService -&gt; orderService에 의한 호출
</span></span><span style=display:flex><span>call AppConfig.memberRepository -&gt; orderService에 의한 호출
</span></span><span style=display:flex><span>call AppConfig.discountPoilcy -&gt; orderService에 의한 호출
</span></span><span style=display:flex><span>call AppConfig.memberRepository -&gt; memberRepository 의한 호출
</span></span><span style=display:flex><span>call AppConfig.discountPoilcy -&gt; discountPoilcy 의한 호출
</span></span></code></pre></td></tr></table></div></div><p>하지만 바로 밑의 결과처럼 다른 결과를 확인할 수 있다.</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text><span style=display:flex><span>call AppConfig.memberService
</span></span><span style=display:flex><span>call AppConfig.memberRepository
</span></span><span style=display:flex><span>call AppConfig.orderService
</span></span><span style=display:flex><span>call AppConfig.discountPoilcy
</span></span></code></pre></td></tr></table></div></div><p>어째서 그런 것일까? 아래 코드를 확인해보자.</p><ul><li><p>테스트 코드</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">5
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">6
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">7
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">8
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#a6e22e>@Test</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>void</span> <span style=color:#a6e22e>configurationTest</span><span style=color:#f92672>()</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>    ApplicationContext ac <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> AnnotationConfigApplicationContext<span style=color:#f92672>(</span>AppConfig<span style=color:#f92672>.</span><span style=color:#a6e22e>class</span><span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    AppConfig appConfig <span style=color:#f92672>=</span> ac<span style=color:#f92672>.</span><span style=color:#a6e22e>getBean</span><span style=color:#f92672>(</span>AppConfig<span style=color:#f92672>.</span><span style=color:#a6e22e>class</span><span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>    System<span style=color:#f92672>.</span><span style=color:#a6e22e>out</span><span style=color:#f92672>.</span><span style=color:#a6e22e>println</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;AppConfig를 getBean으로 가져온 경우: &#34;</span> <span style=color:#f92672>+</span> appConfig<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>    System<span style=color:#f92672>.</span><span style=color:#a6e22e>out</span><span style=color:#f92672>.</span><span style=color:#a6e22e>println</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;AppConfig를 바로 조회한 경우: &#34;</span> <span style=color:#f92672>+</span> AppConfig<span style=color:#f92672>.</span><span style=color:#a6e22e>class</span><span style=color:#f92672>);</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span></code></pre></td></tr></table></div></div></li><li><p>결과</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text><span style=display:flex><span>AppConfig를 getBean으로 가져온 경우: SpringBasic.core.AppConfig$$SpringCGLIB$$0@7a55af6b
</span></span><span style=display:flex><span>AppConfig를 바로 조회한 경우: class SpringBasic.core.AppConfig
</span></span></code></pre></td></tr></table></div></div></li></ul><p>ac는 <code>@Configuration</code>을 추가해 스프링 빈으로 등록된 객체다. 하지만 순수한 자바 객체로서의 스프링 빈이 아니다.
&lsquo;CGLIB&rsquo;라는 바이트코드 조작 라이브러리를 사용해 <code>@Configuration</code>이 붙은 클래스를 상속받는 클래스를 만들고, 이 클래스 객체를 등록한 것이다.
그래서 <code>CGLIB</code> 라는 문자를 확인할 수 있다.</p><p>이 바이트코드 조작 라이브러리가 스프링 빈을 싱글톤으로 작동되도록 보장한다.</p><p>예를 들어 @Bean이 붙은 메서드마다 스프링 빈 저장소에 해당 빈 이름이 이미 존재한다면 생성하지 않는다. 없다면 생성 후 컨테이너에 등록한다.</p><p>만약 @Configuration 없이 @Bean만 적용하면 스프링 빈으로는 등록이 되지만, 싱글톤으로 유지되지 않는다.</p><ul><li>호출 결과</li></ul><pre tabindex=0><code>call AppConfig.memberService
call AppConfig.memberRepository
call AppConfig.orderService
call AppConfig.memberRepository
call AppConfig.memberRepository
</code></pre><p>그래서 항상 스프링 설정 정보는 @Configuration을 사용하자.</p><hr><h1 id=reference>Reference<a hidden class=anchor aria-hidden=true href=#reference>#</a></h1><ul><li><a href=https://www.inflearn.com/course/%EC%8A%A4%ED%94%84%EB%A7%81-mvc-1/dashboard>스프링 MVC 1편 - 백엔드 웹 개발 핵심 기술</a></li><li><a href=https://docs.spring.io/spring-framework/reference/core/beans/introduction.html>Introduction to the Spring IoC Container and Beans</a></li></ul></div><footer class=post-footer><ul class=post-tags><li><a href=http://jeha00.github.io/tags/spring/>Spring</a></li></ul><nav class=paginav><a class=prev href=http://jeha00.github.io/post/spring/study_2/><span class=title>« Prev Page</span><br><span>스프링 빈 자동 등록 방법: 컴포넌트 스캔</span></a>
<a class=next href=http://jeha00.github.io/post/datastructure/hashset/><span class=title>Next Page »</span><br><span>[Data structure] HashSet에 대해 설명해 줄게!</span></a></nav><div class=share-buttons><a target=_blank rel="noopener noreferrer" aria-label="share 스프링 컨테이너, 스프링 빈, 싱글톤 레지스트리란? on twitter" href="https://twitter.com/intent/tweet/?text=%ec%8a%a4%ed%94%84%eb%a7%81%20%ec%bb%a8%ed%85%8c%ec%9d%b4%eb%84%88%2c%20%ec%8a%a4%ed%94%84%eb%a7%81%20%eb%b9%88%2c%20%ec%8b%b1%ea%b8%80%ed%86%a4%20%eb%a0%88%ec%a7%80%ec%8a%a4%ed%8a%b8%eb%a6%ac%eb%9e%80%3f&url=http%3a%2f%2fjeha00.github.io%2fpost%2fspring%2fstudy_1%2f&hashtags=Spring"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM195.519 424.544c135.939.0 210.268-112.643 210.268-210.268.0-3.218.0-6.437-.153-9.502 14.406-10.421 26.973-23.448 36.935-38.314-13.18 5.824-27.433 9.809-42.452 11.648 15.326-9.196 26.973-23.602 32.49-40.92-14.252 8.429-30.038 14.56-46.896 17.931-13.487-14.406-32.644-23.295-53.946-23.295-40.767.0-73.87 33.104-73.87 73.87.0 5.824.613 11.494 1.992 16.858-61.456-3.065-115.862-32.49-152.337-77.241-6.284 10.881-9.962 23.601-9.962 37.088.0 25.594 13.027 48.276 32.95 61.456-12.107-.307-23.448-3.678-33.41-9.196v.92c0 35.862 25.441 65.594 59.311 72.49-6.13 1.686-12.72 2.606-19.464 2.606-4.751.0-9.348-.46-13.946-1.38 9.349 29.426 36.628 50.728 68.965 51.341-25.287 19.771-57.164 31.571-91.8 31.571-5.977.0-11.801-.306-17.625-1.073 32.337 21.15 71.264 33.41 112.95 33.41z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share 스프링 컨테이너, 스프링 빈, 싱글톤 레지스트리란? on linkedin" href="https://www.linkedin.com/shareArticle?mini=true&url=http%3a%2f%2fjeha00.github.io%2fpost%2fspring%2fstudy_1%2f&title=%ec%8a%a4%ed%94%84%eb%a7%81%20%ec%bb%a8%ed%85%8c%ec%9d%b4%eb%84%88%2c%20%ec%8a%a4%ed%94%84%eb%a7%81%20%eb%b9%88%2c%20%ec%8b%b1%ea%b8%80%ed%86%a4%20%eb%a0%88%ec%a7%80%ec%8a%a4%ed%8a%b8%eb%a6%ac%eb%9e%80%3f&summary=%ec%8a%a4%ed%94%84%eb%a7%81%20%ec%bb%a8%ed%85%8c%ec%9d%b4%eb%84%88%2c%20%ec%8a%a4%ed%94%84%eb%a7%81%20%eb%b9%88%2c%20%ec%8b%b1%ea%b8%80%ed%86%a4%20%eb%a0%88%ec%a7%80%ec%8a%a4%ed%8a%b8%eb%a6%ac%eb%9e%80%3f&source=http%3a%2f%2fjeha00.github.io%2fpost%2fspring%2fstudy_1%2f"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM160.461 423.278V197.561h-75.04v225.717h75.04zm270.539.0V293.839c0-69.333-37.018-101.586-86.381-101.586-39.804.0-57.634 21.891-67.617 37.266v-31.958h-75.021c.995 21.181.0 225.717.0 225.717h75.02V297.222c0-6.748.486-13.492 2.474-18.315 5.414-13.475 17.767-27.434 38.494-27.434 27.135.0 38.007 20.707 38.007 51.037v120.768H431zM123.448 88.722C97.774 88.722 81 105.601 81 127.724c0 21.658 16.264 39.002 41.455 39.002h.484c26.165.0 42.452-17.344 42.452-39.002-.485-22.092-16.241-38.954-41.943-39.002z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share 스프링 컨테이너, 스프링 빈, 싱글톤 레지스트리란? on reddit" href="https://reddit.com/submit?url=http%3a%2f%2fjeha00.github.io%2fpost%2fspring%2fstudy_1%2f&title=%ec%8a%a4%ed%94%84%eb%a7%81%20%ec%bb%a8%ed%85%8c%ec%9d%b4%eb%84%88%2c%20%ec%8a%a4%ed%94%84%eb%a7%81%20%eb%b9%88%2c%20%ec%8b%b1%ea%b8%80%ed%86%a4%20%eb%a0%88%ec%a7%80%ec%8a%a4%ed%8a%b8%eb%a6%ac%eb%9e%80%3f"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM446 265.638c0-22.964-18.616-41.58-41.58-41.58-11.211.0-21.361 4.457-28.841 11.666-28.424-20.508-67.586-33.757-111.204-35.278l18.941-89.121 61.884 13.157c.756 15.734 13.642 28.29 29.56 28.29 16.407.0 29.706-13.299 29.706-29.701.0-16.403-13.299-29.702-29.706-29.702-11.666.0-21.657 6.792-26.515 16.578l-69.105-14.69c-1.922-.418-3.939-.042-5.585 1.036-1.658 1.073-2.811 2.761-3.224 4.686l-21.152 99.438c-44.258 1.228-84.046 14.494-112.837 35.232-7.468-7.164-17.589-11.591-28.757-11.591-22.965.0-41.585 18.616-41.585 41.58.0 16.896 10.095 31.41 24.568 37.918-.639 4.135-.99 8.328-.99 12.576.0 63.977 74.469 115.836 166.33 115.836s166.334-51.859 166.334-115.836c0-4.218-.347-8.387-.977-12.493 14.564-6.47 24.735-21.034 24.735-38.001zM326.526 373.831c-20.27 20.241-59.115 21.816-70.534 21.816-11.428.0-50.277-1.575-70.522-21.82-3.007-3.008-3.007-7.882.0-10.889 3.003-2.999 7.882-3.003 10.885.0 12.777 12.781 40.11 17.317 59.637 17.317 19.522.0 46.86-4.536 59.657-17.321 3.016-2.999 7.886-2.995 10.885.008 3.008 3.011 3.003 7.882-.008 10.889zm-5.23-48.781c-16.373.0-29.701-13.324-29.701-29.698.0-16.381 13.328-29.714 29.701-29.714 16.378.0 29.706 13.333 29.706 29.714.0 16.374-13.328 29.698-29.706 29.698zM160.91 295.348c0-16.381 13.328-29.71 29.714-29.71 16.369.0 29.689 13.329 29.689 29.71.0 16.373-13.32 29.693-29.689 29.693-16.386.0-29.714-13.32-29.714-29.693z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share 스프링 컨테이너, 스프링 빈, 싱글톤 레지스트리란? on facebook" href="https://facebook.com/sharer/sharer.php?u=http%3a%2f%2fjeha00.github.io%2fpost%2fspring%2fstudy_1%2f"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H342.978V319.085h66.6l12.672-82.621h-79.272v-53.617c0-22.603 11.073-44.636 46.58-44.636H425.6v-70.34s-32.71-5.582-63.982-5.582c-65.288.0-107.96 39.569-107.96 111.204v62.971h-72.573v82.621h72.573V512h-191.104c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share 스프링 컨테이너, 스프링 빈, 싱글톤 레지스트리란? on whatsapp" href="https://api.whatsapp.com/send?text=%ec%8a%a4%ed%94%84%eb%a7%81%20%ec%bb%a8%ed%85%8c%ec%9d%b4%eb%84%88%2c%20%ec%8a%a4%ed%94%84%eb%a7%81%20%eb%b9%88%2c%20%ec%8b%b1%ea%b8%80%ed%86%a4%20%eb%a0%88%ec%a7%80%ec%8a%a4%ed%8a%b8%eb%a6%ac%eb%9e%80%3f%20-%20http%3a%2f%2fjeha00.github.io%2fpost%2fspring%2fstudy_1%2f"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zm-58.673 127.703c-33.842-33.881-78.847-52.548-126.798-52.568-98.799.0-179.21 80.405-179.249 179.234-.013 31.593 8.241 62.428 23.927 89.612l-25.429 92.884 95.021-24.925c26.181 14.28 55.659 21.807 85.658 21.816h.074c98.789.0 179.206-80.413 179.247-179.243.018-47.895-18.61-92.93-52.451-126.81zM263.976 403.485h-.06c-26.734-.01-52.954-7.193-75.828-20.767l-5.441-3.229-56.386 14.792 15.05-54.977-3.542-5.637c-14.913-23.72-22.791-51.136-22.779-79.287.033-82.142 66.867-148.971 149.046-148.971 39.793.014 77.199 15.531 105.329 43.692 28.128 28.16 43.609 65.592 43.594 105.4-.034 82.149-66.866 148.983-148.983 148.984zm81.721-111.581c-4.479-2.242-26.499-13.075-30.604-14.571-4.105-1.495-7.091-2.241-10.077 2.241-2.986 4.483-11.569 14.572-14.182 17.562-2.612 2.988-5.225 3.364-9.703 1.12-4.479-2.241-18.91-6.97-36.017-22.23C231.8 264.15 222.81 249.484 220.198 245s-.279-6.908 1.963-9.14c2.016-2.007 4.48-5.232 6.719-7.847 2.24-2.615 2.986-4.484 4.479-7.472 1.493-2.99.747-5.604-.374-7.846-1.119-2.241-10.077-24.288-13.809-33.256-3.635-8.733-7.327-7.55-10.077-7.688-2.609-.13-5.598-.158-8.583-.158-2.986.0-7.839 1.121-11.944 5.604-4.105 4.484-15.675 15.32-15.675 37.364.0 22.046 16.048 43.342 18.287 46.332 2.24 2.99 31.582 48.227 76.511 67.627 10.685 4.615 19.028 7.371 25.533 9.434 10.728 3.41 20.492 2.929 28.209 1.775 8.605-1.285 26.499-10.833 30.231-21.295 3.732-10.464 3.732-19.431 2.612-21.298-1.119-1.869-4.105-2.99-8.583-5.232z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share 스프링 컨테이너, 스프링 빈, 싱글톤 레지스트리란? on telegram" href="https://telegram.me/share/url?text=%ec%8a%a4%ed%94%84%eb%a7%81%20%ec%bb%a8%ed%85%8c%ec%9d%b4%eb%84%88%2c%20%ec%8a%a4%ed%94%84%eb%a7%81%20%eb%b9%88%2c%20%ec%8b%b1%ea%b8%80%ed%86%a4%20%eb%a0%88%ec%a7%80%ec%8a%a4%ed%8a%b8%eb%a6%ac%eb%9e%80%3f&url=http%3a%2f%2fjeha00.github.io%2fpost%2fspring%2fstudy_1%2f"><svg viewBox="2 2 28 28"><path d="M26.49 29.86H5.5a3.37 3.37.0 01-2.47-1 3.35 3.35.0 01-1-2.47V5.48A3.36 3.36.0 013 3 3.37 3.37.0 015.5 2h21A3.38 3.38.0 0129 3a3.36 3.36.0 011 2.46V26.37a3.35 3.35.0 01-1 2.47 3.38 3.38.0 01-2.51 1.02zm-5.38-6.71a.79.79.0 00.85-.66L24.73 9.24a.55.55.0 00-.18-.46.62.62.0 00-.41-.17q-.08.0-16.53 6.11a.59.59.0 00-.41.59.57.57.0 00.43.52l4 1.24 1.61 4.83a.62.62.0 00.63.43.56.56.0 00.4-.17L16.54 20l4.09 3A.9.9.0 0021.11 23.15zM13.8 20.71l-1.21-4q8.72-5.55 8.78-5.55c.15.0.23.0.23.16a.18.18.0 010 .06s-2.51 2.3-7.52 6.8z"/></svg></a></div></footer></article></main><footer class=footer><span>&copy; 2025 <a href=http://jeha00.github.io/>Jeha DevLog</a></span>
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://git.io/hugopapermod rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg></a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerText="copy";function s(){t.innerText="copied!",setTimeout(()=>{t.innerText="copy"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></body></html>